KODI RENAMER - GO VERSION
=========================

A command-line tool to rename movie and TV series files for Kodi media center
using TheTVDB and/or TheMovieDB APIs.

⚠️  IMPORTANT: Version 2.x introduces a new 4-directory structure!
See MIGRATION_GUIDE.md if upgrading from v1.x

FEATURES
--------
- Supports TVDB and TMDB APIs (use one or both)
- Automatically detects movies and TV series from filenames
- Parses season/episode information (S01E01, 1x01 formats)
- Extracts year information from movie filenames
- Searches both APIs and merges results
- Interactive selection of correct match
- Dry-run mode to preview changes
- Auto mode for batch processing
- 4 separate directories for organized workflow:
  * Movie input/output directories
  * Series input/output directories
- Optional in-place renaming or move to separate output directories

DIRECTORY CONFIGURATION (NEW in v2.x)
--------------------------------------
Configure 4 separate directories for better organization:

1. MOVIE_TO_RENAME_DIR - Input directory for movies to rename
2. MOVIE_RENAMED_DIR - Output directory for renamed movies (optional)
3. SERIE_TO_RENAME_DIR - Input directory for series to rename
4. SERIE_RENAMED_DIR - Output directory for renamed series (optional)

See CONFIGURATION.md for detailed setup instructions.

QUICK START
-----------
1. Set API keys:
   export TVDB_API_KEY='your-tvdb-key'
   export TMDB_API_KEY='your-tmdb-key'

2. Set directories:
   export MOVIE_TO_RENAME_DIR='/path/to/movies'
   export SERIE_TO_RENAME_DIR='/path/to/series'

3. Run:
   ./kodi-renamer -dry-run  # Preview changes
   ./kodi-renamer           # Actually rename

Or use Makefile targets:
   make run-movies MOVIE_TO_RENAME_DIR=/path/to/movies
   make run-series SERIE_TO_RENAME_DIR=/path/to/series

API CONFIGURATION
-----------------
You can use TVDB, TMDB, or BOTH APIs (recommended for best results):

Via environment variables:
   export TVDB_API_KEY='your-tvdb-key'
   export TMDB_API_KEY='your-tmdb-key'

Via command line flags:
   ./kodi-renamer -tvdb-key 'key1' -tmdb-key 'key2'

GET API KEYS
------------
TVDB: https://thetvdb.com/api-information
TMDB: https://www.themoviedb.org/settings/api

INSTALLATION
------------

METHOD 1: Docker (Recommended for Easy Setup)
----------------------------------------------
1. Ensure Docker is installed
2. Build the Docker image:

   make docker-build

3. Run with Docker:

   export TVDB_API_KEY='your-tvdb-key'
   export TMDB_API_KEY='your-tmdb-key'
   make docker-run

For detailed Docker usage, see DOCKER.md

METHOD 2: Native Binary Build
------------------------------
1. Ensure Go 1.20+ is installed
2. Build the application:

   Option 1 - Using Makefile (recommended):
   make build

   Option 2 - Using go build directly:
   go build -o kodi-renamer ./cmd/kodi-renamer

MAKEFILE TARGETS
----------------
The project includes a Makefile for convenient building and running:

  make             - Build and run the application (default)
  make build       - Build the application binary
  make run         - Run the application
  make clean       - Remove build artifacts
  make test        - Run tests
  make fmt         - Format source code
  make deps        - Download and tidy dependencies
  make install     - Install binary to GOPATH/bin
  make build-all   - Build for multiple platforms (Linux, macOS, Windows)
  make dry-run     - Build and run in dry-run mode
  make auto        - Build and run in automatic mode
  make help        - Show available targets

Docker targets:
  make docker-build   - Build Docker image with distroless
  make docker-run     - Run Docker container
  make docker-dry-run - Run Docker in dry-run mode
  make docker-clean   - Remove Docker image
  make docker         - Build and run Docker in one command

Quick start with Makefile:
  # Set your API keys
  export TVDB_API_KEY='your-tvdb-key'
  export TMDB_API_KEY='your-tmdb-key'

  # Build and run
  make

  # Or preview changes first
  make dry-run

DOCKER USAGE
------------
Using Docker (no Go installation required):

  # Build image
  make docker-build

  # Run interactively
  make docker-run

  # Preview mode
  make docker-dry-run

  # Custom directory
  make docker-run-dir DIR=/path/to/media

Or with docker-compose:
  cp env.example .env
  # Edit .env with your API keys
  docker-compose run --rm kodi-renamer

See DOCKER.md for comprehensive Docker documentation.

USAGE
-----
Basic usage (interactive mode):
  ./kodi-renamer -dir /path/to/media

Dry run (preview without renaming):
  ./kodi-renamer -dir /path/to/media -dry-run

Auto mode (select first match automatically):
  ./kodi-renamer -dir /path/to/media -auto

Combine flags:
  ./kodi-renamer -dir /path/to/media -dry-run -auto

COMMAND LINE OPTIONS
--------------------
  -tvdb-key string
        TVDB API Key (or set TVDB_API_KEY env var)

  -tmdb-key string
        TMDB API Key (or set TMDB_API_KEY env var)

  -dir string
        Directory to scan for media files (default: current directory)

  -dry-run
        Preview mode - show what would be renamed without making changes

  -auto
        Automatic mode - select first search result without prompting

NOTE: At least one API key (TVDB or TMDB) must be provided

EXAMPLES
--------
1. Use both APIs for best results:
   export TVDB_API_KEY='your-tvdb-key'
   export TMDB_API_KEY='your-tmdb-key'
   ./kodi-renamer

2. Preview changes with TMDB only:
   ./kodi-renamer -tmdb-key 'your-key' -dir ~/Downloads -dry-run

3. Batch rename with both APIs:
   ./kodi-renamer -tvdb-key 'key1' -tmdb-key 'key2' -dir /media/unsorted -auto

SUPPORTED FILE FORMATS
----------------------
Movies:
  - The.Matrix.1999.1080p.mkv
  - Inception (2010) 720p.mp4
  - Pulp.Fiction.[1994].BluRay.avi

TV Series:
  - Breaking.Bad.S01E01.720p.mkv
  - Game.of.Thrones.3x09.HDTV.avi
  - Friends.1x05.The.One.with.the.Laundry.mkv

Supported extensions:
  .mkv, .mp4, .avi, .mov, .wmv, .flv, .webm, .m4v

OUTPUT FORMAT
-------------
Movies:
  Title (Year).ext
  Example: The Matrix (1999).mkv

TV Series:
  Series Name S##E## - Episode Name.ext
  Example: Breaking Bad S01E01 - Pilot.mkv

API BEHAVIOR
------------
When both APIs are configured:
  - Both APIs are searched in parallel
  - Results are merged and sorted
  - TVDB results appear first, then TMDB (sorted by popularity)
  - User sees source indicator: [tvdb] or [tmdb]
  - Selected source is used for detailed metadata

When only one API is configured:
  - Only that API is used
  - No merging necessary
  - Faster operation

TESTING
-------
Test the scanner without API:
  go build -o test-scanner ./cmd/test-scanner
  ./test-scanner -dir /path/to/media

Run test suite:
  ./test_scanner.sh

PROJECT STRUCTURE
-----------------
kodi-renamer-go/
  cmd/
    kodi-renamer/       Main application
    test-scanner/       Scanner testing utility
  internal/
    api/                Unified API manager
    scanner/            File scanning and parsing
    tvdb/               TVDB API client
    tmdb/               TMDB API client
    renamer/            File renaming logic
    ui/                 Interactive user interface
  Dockerfile            Multi-stage Docker build
  docker-compose.yml    Docker Compose configuration
  .dockerignore         Docker build exclusions
  Makefile              Build automation
  go.mod                Go module definition
  go.sum                Dependency checksums
  DOCKER.md             Docker documentation
  BUILD.md              Build documentation
  QUICKSTART.md         Quick start guide

WORKFLOW
--------
1. Scans directory for video files
2. Parses filenames to detect movies vs TV series
3. Searches configured APIs (TVDB and/or TMDB)
4. Merges results if both APIs configured
5. Presents matches to user (or auto-selects in auto mode)
6. Retrieves detailed metadata from selected source
7. Renames files according to Kodi conventions

NOTES
-----
- Always use -dry-run first to verify results
- The tool preserves original file extensions
- Files are renamed in place (same directory)
- Special characters in titles are sanitized
- Duplicate names are prevented
- Using both APIs provides more results
- TMDB results are sorted by popularity

ERROR HANDLING
--------------
- No API keys: Clear error message with instructions
- Invalid API key: Authentication error with source indicated
- No results found: File will be skipped
- API rate limits: Tool will report errors, retry manually
- File conflicts: Renaming is skipped if target file exists
- One API fails: Other API results still shown (if configured)

MIGRATION FROM PYTHON VERSION
------------------------------
- No database functionality (pure API operation)
- Added TMDB support alongside TVDB
- Improved performance (compiled binary)
- Better error handling
- Unified API management

LICENSE
-------
Rewrite of the original Python version in Go.
Added multi-API support and modern architecture.
